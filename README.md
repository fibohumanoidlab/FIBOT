<h1 align="center">Localization </h1>

Repository ‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ implementation ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö localization ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Humanoid robot ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á(‡πÉ‡∏ä‡πâ Lidar ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ) ‡πÅ‡∏•‡∏∞‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡πÄ‡∏ä‡πà‡∏ô IMU ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å odom estimation ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏£‡∏±‡∏ö‡∏£‡∏π‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏∏‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°‡πÑ‡∏î‡πâ

![test](image/localization_sim.png)

‡πÇ‡∏î‡∏¢‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô simulation ‡πÄ‡πÄ‡∏•‡∏∞ ‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£ segmentation ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏ö‡∏ô‡∏£‡∏π‡∏õ ‡πÇ‡∏î‡∏¢‡∏ó‡∏≥‡∏™‡∏ô‡∏≤‡∏°‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÉ‡∏ô gazebo ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏´‡∏ç‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏™‡∏µ‡∏î‡∏≥‡πÄ‡πÄ‡∏•‡∏∞ ‡πÄ‡∏™‡πâ‡∏ô‡∏™‡∏ô‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß

‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥
1. ‡πÄ‡πÄ‡∏õ‡∏•‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á web camera ‡∏ã‡∏∂‡πà‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô perspective ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏û Top view ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ IPM
2. ‡∏´‡∏≤ pixel ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß(‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£ segment ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏™‡∏ô‡∏≤‡∏°‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏™‡∏ô‡∏≤‡∏°‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß) ‡πÄ‡πÄ‡∏•‡πâ‡∏ß‡πÄ‡πÄ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô laserscan msg
3. ‡∏ô‡∏≥laserscan msg ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö amcl ‡∏Ç‡∏≠‡∏á navigation2


<!-- ROADMAP -->
# Roadmap
- [x] Setup gazebo environment
- [x] Camera to topview 
- [x] topview to laserscan msg in simulation
- [x] camera move in pitch and yaw (simulation) # note not good in simulation!!!
- [ ] Localize with AMCL(Nav2) in simulation
  - [ ] [in progress 90%] by only camera to laserscan [‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÄ‡∏ü‡∏£‡∏° odom ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏ñ‡πâ‡∏≤sim‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏ü‡∏£‡∏°‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ‡∏à‡∏≤‡∏á‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏±‡πâ‡∏ô]
  - [ ] by sensor fusion (IMU + odom + camera to laserscan) 
- [ ] topview to laserscan msg in real world (waiting segmentation node from AI team)
- [ ] implement Localization in real world

# Table of Contents

1. [System requirements](#System-requirements)
2. [Installation](#Installation)
3. [Quickstart](#Quickstart)
4. [Suggestion](#Suggestion)
5. [Contact](#Contact)
6. [Acknowledgments](#Acknowledgments)

<a name="System-requirements"></a>
# System requirements
  
* Ubuntu 20.04 
* ROS2 (Foxy)
  
<!-- <a name="Built-With"></a>
# Built With

This section should list any major frameworks/libraries used to bootstrap your project. Leave any add-ons/plugins for the acknowledgements section. Here are a few examples.

* [![docs][docs.ros]][https://docs.ros.org/en/foxy/index.html]
* [![React][React.js]][React-url]
* [![Vue][Vue.js]][Vue-url] -->
  
<!-- # Document
this document be a part of FRA506 humanoid. In this document including of introduction content conclusion and suggestion -->

<a name="Installation"></a>
# Installation
  
### 1. Install opencv
```
pip3 install opencv-python
```
### 2. Install navigation2
```
sudo apt install ros-foxy-navigation2
```
<!-- ## install ros2-control
```
sudo apt install ros-foxy-ros2-control ros-foxy-ros2-controllers ros-foxy-gazebo-ros2-control
``` -->

<a name="Quickstart"></a>
# Quickstart
                   
### 1. Spawn robot in gazebo.
               
```                
ros2 launch fibot_gazebo spawn2.launch.py               
```
### 2. Start camera to laserscan node.

```
ros2 run localization_pkg py_node_champ.py 
```

### 3. Start nav2 to use AMCL for localization.
```
ros2 launch localization_pkg nav2.launch.py
```
### 4. Start teleop node
```
ros2 run tele
```
### 5. then move the robot by teleop, you will see like below.

![](image/amcl.gif)
              
# About camera to topview(IPM)
source: https://github.com/ika-rwth-aachen/Cam2BEV/tree/master/preprocessing/ipm

<a name="Suggestion"></a>
# Suggestion

1. ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ü‡∏£‡∏° odom ‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢‡∏ï‡∏≠‡∏ô sim ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÇ‡∏î‡∏¢‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à Nav2
2. code ‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏õ‡πá‡∏ô topview ‡∏î‡πâ‡∏ß‡∏¢‡∏ü‡∏±‡∏á‡∏ä‡∏±‡∏ô warpperspective ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≤‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô  30 fps ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ cuda ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ 30 fps++ ‡πÅ‡∏ï‡πà‡∏ô‡∏≤‡∏ô‡πÜ‡∏ó‡∏µ‡πà‡∏ï‡∏Å‡πÑ‡∏õ 20 fps
3. ‡∏ï‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏¢‡∏´‡∏≤‡∏û‡∏≠‡∏™‡∏°‡∏Ñ‡∏ß‡∏£ ‡πÄ‡∏ä‡πà‡∏ô ‡∏†‡∏≤‡∏û‡∏ô‡πà‡∏≤‡∏à‡∏∞‡∏™‡∏±‡πà‡∏ô‡πÑ‡∏´‡∏ß‡∏≠‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏™‡∏ô‡∏≤‡∏°‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏î‡πâ
4. ‡∏Ç‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å laserscan ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å topview ‡∏à‡∏∞‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î list = 360(‡∏≠‡∏á‡∏®‡∏≤) x ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô range ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡πÉ‡∏ô 1 angle ‡∏°‡∏µ‡∏£‡∏∞‡∏¢‡∏∞ 3 ‡πÅ‡∏•‡∏∞ 5 ‡πÄ‡∏°‡∏ï‡∏£ (range = 2) ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• laserscan ‡∏à‡∏∞‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö len ‡∏Ç‡∏≠‡∏á list = 360x2 = 720 ‡∏ã‡∏∂‡πà‡∏á‡∏ï‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡πÄ‡∏õ‡πá‡∏ô 100 range ‡πÑ‡∏î‡πâ ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ list ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏ß‡∏°‡∏≤‡∏Å ‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô AMCL ‡πÑ‡∏´‡∏° ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏â‡∏∞‡∏ô‡∏±‡πâ‡∏ô‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ                
<!-- CONTACT -->
  
<a name="Contact"></a>
# Contact

### Patcharapon Thaweepanyayos - patcharaponthaweepanyayos@gmail.com
### Piamsuk Noipong - piamsuk.robot@mail.kmutt.ac.th
Project Link: [https://github.com/fibohumanoidlab/FIBOT_Github/tree/localization](https://github.com/fibohumanoidlab/FIBOT_Github/tree/localization)


  
  
<!-- ACKNOWLEDGMENTS -->
                                       
<a name="Acknowledgments"></a>
# Acknowledgments

Use this space to list resources you find helpful and would like to give credit to. I've included a few of my favorites to kick things off!

* [navigation2](https://navigation.ros.org/getting_started/index.html#getting-started)
* [ros2 control example](https://articulatedrobotics.xyz/mobile-robot-12-ros2-control/)
* [Malven's Flexbox Cheatsheet](https://flexbox.malven.co/)
* [Malven's Grid Cheatsheet](https://grid.malven.co/)
* [Img Shields](https://shields.io)
* [GitHub Pages](https://pages.github.com)
* [Font Awesome](https://fontawesome.com)
* [React Icons](https://react-icons.github.io/react-icons/search)



<!-- ## Code Contributors

This project exists thanks to all the people who contribute. 
<a href="https://github.com/fibohumanoidlab/FIBOT_Github/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=fibohumanoidlab/FIBOT_Github" />
</a>

  
 

## ü§ù Contributing

Contributions, issues and feature requests are welcome.<br />
Feel free to check [issues page](https://github.com/fibohumanoidlab/FIBOT_Github/issues) if you want to contribute.<br /> -->



### Note for Sua
"""sudo apt install ros-<ros2-distro>-robot-localization"""
  https://navigation.ros.org/setup_guides/odom/setup_odom.html
  
  ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏° <exec_depend>robot_localization</exec_depend>
  
  sudo apt install ros-foxy-ros2-control ros-foxy-ros2-controllers ros-foxy-gazebo-ros2-control
